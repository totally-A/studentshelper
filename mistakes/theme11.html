<!DOCTYPE html>
<html>
<head>
	<title>Student's Helper: Динамічна пам'ять</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="../css/style.css">
	<link rel="stylesheet" href="../css/articles.css">
	<link rel="shortcut icon" href="../img/icons/mortarboard.ico">

	<!-- Bootsrap feauters -->
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="../bootstrap-3.3.6-dist/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="../bootstrap-3.3.6-dist/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="../bootstrap-3.3.6-dist/js/bootstrap.min.js"></script>

	<!-- Font Awesome -->
	<link rel="stylesheet" href="../font-awesome-4.6.3/css/font-awesome.min.css">

	<!-- Fonts -->
	<link href='https://fonts.googleapis.com/css?family=Jura:600&subset=latin,cyrillic,cyrillic-ext' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Lobster&subset=latin,cyrillic' rel='stylesheet' type='text/css'>
</head>
<body>
	<header>
		<div class="wrapper">
			<a href="../index.html" class="logo">
				<div class="emblem">
					
				</div>
				<div class="text">
					Student's Helper
				</div>			
			</a>
			<div class="top-nav">
				<nav>
					<ul>
						<a href="../index.html">
							<li class="general">Головна
								<div class="arrow"></div>
							</li>
						</a>
						<a href="../theory.html">
							<li class="theory">Теорія
								<div class="arrow"></div>
							</li>
						</a>
						<a href="../tests.html">
							<li class="tests">Тести
								<div class="arrow"></div>
							</li>
						</a>
					</ul>
				</nav>
			</div>
		</div>
	</header>
	<div class="main">
		<div class="wrapper">
			<div class="info">
				<h2>
					Функція malloc() у мові С
				</h2>
				<p>
					Прототип функції malloc():
				</p>
				<pre>void * malloc( size_t sizemem );</pre>
				<p>Функція malloc виділяє блок пам'яті, розміром sizemem байт, і повертає покажчик на початок блоку.<br/>
Зміст виділеного блоку пам'яті не ініціалізується, він залишається з невизначеними значеннями.
Параметри:<br/>
sizemem<br/>
Розмір виділеного блоку пам'яті в байтах.<br/>
Значення, що повертається<br/>
Покажчик на виділений блок пам'яті. Тип даних на який посилається покажчик завжди void*, тому це тип даних може бути приведений до бажаного типу даних.<br/>
Якщо функції не вдалося виділити необхідний блок пам'яті, повертається нульовий покажчик.<br/>
</p>
				<h3>
					Типові помилки програмування
				</h3>
				<ul class="main-info">
					<li>Якщо не звільнити виділену динамічно пам’ять після того, як вона вже перестала використовуватися, то це може призвести до того, що пам’ять у системі передчасно закінчиться. Інколи це називають «витік пам’яті».</li>
					<li>Спроба звільнити пам’ять, яка не була виділена динамічно за допомогою malloc.</li>
					<li>Посилання на блок пам’яті, який був звільнений.</li>
				</ul>

				<div class="example">
					<h3>
					Приклад програми
				</h3>
				<p>
					Наступна програма створює рядок довжиною вказаною користувачем і заповнює її символами алфавіту. Можлива довжина цього рядка обмежена тільки кількістю вільної пам'яті в системі, яку malloc() може виділити.
				</p>
				<pre>
//Example of using malloc() function
#include < iostream >
#include < cstdlib >

int main()
{
	system("color F0");
	int len;
	
	puts("Input length of string: ");
	scanf("%d", &len);

	char * buffer = (char*)malloc(len + 1);              //dynamic allocation of memory for the character string
	if (buffer == NULL) exit(1);                        //if the memory allocation is not performed then complete the program

	for (int ix = 0; ix < len; ix++)
		buffer[ix] = rand() % 26 + 'a';
	buffer[len] = '\0';                                                   //null element
	puts("Random string:");
	puts(buffer);
	free(buffer);                                                         //make memory free

	system("pause");
}
				</pre>
				<p>
					Завантажте "Аналіз коду" для подробиць.
				</p>
			</div>


				<h2>
					Функція Calloc у мові С
				</h2>
				<p>
					Виділяє блок пам'яті під numelems елементів і розміром sizelem байтів кожний. Пам'ять обнуляється і повертається покажчик на неї. У разі помилки (наприклад, недостатньо пам'яті) NULL повернеться. якщо numelems або sizelem дорівнює 0, NULL повертається. розмір пам'яті не повинен перевищувати 64 Кбайта.<br/>
Використання

				</p>
				<pre>#include < stdlib.h >
void * calloc (unsigned numelems, size_t sizelem);
</pre>
				<p>Pначення, що повертаються<br/>
При вдалому завершенні повертає покажчик на виділену пам'ять; в іншому випадку - NULL.<br/>
Які бувають помилки:<br/>
1. Втрата пам'яті<br/>
</p>
<pre>
int * p = (int *) malloc (100);
p = (int *) malloc (200); // Втрачений покажчик на перші 100 int’ів, які тепер не можна віддати назад ОС
</pre>
<p>
2.Повторное звільнення виділеної пам'яті
</p>
<pre>
free (p); ... Free (p); // Невизначена поведінка
правильно:
free (p);
p = 0;
free (p); // Відпрацює без помилок
</pre>
<p>
	Через те, що malloc() не ініціалізує пам’ять, а calloc() це спокійно робить, програмісти надають перевагу calloc(). Calloc() – це бібліотечна функція, яка дуже схожа на функцію malloc(), з двома основними відмінностями. У функції calloc(), необхідно вказати два параметра, а не один: кількість елементів і розмір кожного елемента. За допомогою цих параметрів визначається розмір блоку пам'яті для розміщення, параметри повинні відповідати типу size_t. Друга відмінність полягає в тому, що функція calloc () ініціалізує пам'ять. Значення, яке використовується для ініціалізації пам'яті є абсолютний нуль, який зазвичай, але не завжди обчислюється з плаваючою комою або значенням покажчика NULL. Це нормально, якщо пам'ять буде використовуватися для зберігання рядка або цілого числа. Якщо пам'ять буде використовуватися для значень з плаваючою точкою, ви повинні явно ініціалізувати блок пам'яті після callo (). Я рекомендую вам завжди форматувати пам'ять, виділену з calloc(), якщо ви не знаєте, формат даних, які ви будете зберігати в ньому.
</p>
				<h3>
					Типові помилки програмування
				</h3>
				<ul class="main-info">
					<li>Якщо не звільнити виділену динамічно пам’ять після того, як вона вже перестала використовуватися, то це може призвести до того, що пам’ять у системі передчасно закінчиться. Інколи це називають «витік пам’яті».</li>
					<li>Спроба звільнити пам’ять, яка не була виділена динамічно за допомогою calloc.</li>
					<li>Посилання на блок пам’яті, який був звільнений.</li>
				</ul>

				<div class="example">
					<h3>
					Приклад програми
				</h3>
				<p>
					Наступна програма виділяє блоки пам'яті. Розмір найбільшого блоку не може бути визначений наперед, тому програма починається з найбільшого розміру (використовуючи розмір int) і намагається виділити масив 32767 членів. Якщо calloc () зазнає невдачі, програма зменшує розмір на 50 відсотків; Це продовжується до тих пір, поки розмір не стане менше, ніж 2 байти. Програма виділяє буфери, кожна з яких містить 32767 2-байтових цілих чисел. Коли запит розподілу зазнає невдачі, програма зменшує розмір, поки більше пам'яті не може бути виділені. Вона не зупиняється, коли немає більше пам'яті. Єдина істотна відмінність між malloc() і calloc() є виклик функції розподілу пам'яті. Код програми:
				</p>
				<pre>
/* CALLOC1, written 1992 by Peter D. Hipson
* This program allocates arrays of memory.
*/
#include < stdio.h >                                                                  //make includes first part of file
#include < string.h >                                                                 //for string functions
#include < malloc.h >                                                               //for memory allocation functions
#include < iostream >
int main();                                                                              //define main() and establish that this
//================== program does not use any passed parameters ================
int main()
{
	system("color F0");
	int i = 0;
	int j = 0;
	int *nPointer[100] = { NULL };
	int nSize = 32767;
	long lTotalBytes = 0;
	while (nSize > 0 &&                                                 //make nSize valid
		nSize <= 32767 &&
		lTotalBytes < 2000000)                            //mo more than 2M will be allocated
	{
		nPointer[i] = (int *)calloc(nSize, sizeof(int));
		if (nPointer[i] != NULL)
		{
			++i;
			lTotalBytes += (nSize * sizeof(int));
			printf("Allocated % 5u short int, total % 10ld\n",
				nSize,
				lTotalBytes);
		}
		else
		{
			printf("Couldn’t allocate % 5u short int, total % 10ld\n",
				nSize,
				lTotalBytes);
			nSize /= 2;
		}
	}
	for (j = 0; j < i; j++)
	{
			free(nPointer[j]);
		nPointer[j] = NULL;
	}
	system("pause");
}

				</pre>
				<p>
					Завантажте "Аналіз коду" для подробиць.
				</p>
			</div>
			</div>
			<div class="buttons">
				<a href="../material/Malloc Calloc.zip" class="review button" download>
					Аналіз коду
				</a>
			</div>

			<a href="../mistakes.html" class="back-btn"><i class="fa fa-long-arrow-left" aria-hidden="true"></i>Назад</a>	
		</div>
	</div>
	<footer>
		<div class="wrapper">
			<div class="line-1">
				<div class="short-info">
					Student's Helper - це український волонтерський проект, розроблений для того, щоб допомогти студенту у галузі програмування.
				</div>
				<div class="bot-nav">
					<nav>
						<ul>
							<a href="../documentation.html">
								<li>Про проект</li>
							</a>
							<a href="../devs.html">
								<li>Розробники</li>
							</a>
						</ul>
					</nav>
				</div>
			</div>		
			<div class="line-2">
				© 2016 Найкраща тіма на світі. Усі права захищені.
			</div>	
		</div>
	</footer>
</body>
</html>